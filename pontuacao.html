{% extends "base.html" %}

{% block title %}Qualificação{% endblock %}

{% block content %}
    <h1>SALDO ANTERIOR, NOVAS QUALIFICAÇÕES, PONTOS UTILIZADOS E SALDO POSTERIOR</h1>
    <p>nome: {{ session['usuario_nome'] }}</p>
    <p>matrícula: {{ session['usuario_matricula'] }}</p>

    <form>
        <div class="form-group">
            <label for="considera-novas-qualificacoes">As novas qualificações serão consideradas para esta progressão?</label><br>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="considera-novas-qualificacoes-sim" name="considera-novas-qualificacoes" value="sim">
                <label class="form-check-label" for="considera-novas-qualificacoes-sim">sim</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="considera-novas-qualificacoes-nao" name="considera-novas-qualificacoes" value="nao">
                <label class="form-check-label" for="considera-novas-qualificacoes-nao">não</label>
            </div>
        </div>

        <div class="form-group">
            <label for="primeira-progressao">Sua progressão será a primeira, ou seja, a do estágio probatório?</label><br>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="primeira-progressao-sim" name="primeira-progressao" value="sim">
                <label class="form-check-label" for="primeira-progressao-sim">sim</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="primeira-progressao-nao" name="primeira-progressao" value="nao">
                <label class="form-check-label" for="primeira-progressao-nao">não</label>
            </div>
        </div>
    </form>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>qualificação</th>
                <th>saldo anterior pontos / horas</th>
                <th>novas qualificações</th>
                <th>total de pontos</th>
                <th>progressão mês/ano</th>
                <th>saldo final</th>
            </tr>
        </thead>
        <tbody>
            {% for q in qualificacoes %}
            <tr>
                <td>{{ q.qualificacao }}</td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="saldo-anterior-{{ loop.index }}" value=""></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="novas-qualificacoes-{{ loop.index }}" value=""></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="total-pontos-{{ loop.index }}" value=""></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="progresso-{{ loop.index }}" value=""></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="saldo-final-{{ loop.index }}" value=""></td>
            </tr>
            {% endfor %}
            <tr>
                <td><strong>TOTAL</strong></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="saldo-anterior-total" value=""></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="novas-qualificacoes-total" value=""></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="total-pontos-total" value=""></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="progresso-total" value=""></td>
                <td><input type="text" class="form-control underline-input" placeholder="-" id="saldo-final-total" value=""></td>
            </tr>
        </tbody>
    </table>

    <p>* Pontuação máxima utilizável: 10 (dez) pontos a cada período de 2 (dois) anos.</p>
    <p>** Pontuação máxima utilizável: 15 (quinze) pontos a cada período de 2 (dois) anos.</p>
    <p><strong>ORDEM DE USO DOS PONTOS:</strong></p>
    <p>1. inicia-se pelos grupos COM limites de uso, daquele com maior pontuação utilizável para o de menor;</p>
    <p>2. depois, pelos grupos SEM limites de uso, daquele com maior pontuação por qualificação para o de menor.</p>

    <style>
        .underline-input::placeholder {
            text-decoration: underline;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to handle checkbox logic
            function handleCheckboxes(group) {
                const checkboxes = document.querySelectorAll(`input[name="${group}"]`);
                
                // Load the saved state from local storage
                const savedValue = localStorage.getItem(group);
                if (savedValue) {
                    checkboxes.forEach((checkbox) => {
                        if (checkbox.value === savedValue) {
                            checkbox.checked = true;
                        }
                    });
                }

                checkboxes.forEach((checkbox) => {
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            checkboxes.forEach((cb) => {
                                if (cb !== this) cb.checked = false;
                            });
                            // Save the selected value to local storage
                            localStorage.setItem(group, this.value);
                        } else {
                            localStorage.removeItem(group);
                        }
                    });
                });
            }

            function handleInputs(selector) {
                const inputs = document.querySelectorAll(selector);

                inputs.forEach((input) => {
                    const savedValue = localStorage.getItem(input.id);
                    if (savedValue) {
                        input.value = savedValue;
                    }

                    input.addEventListener('input', function() {
                        localStorage.setItem(input.id, this.value);
                    });
                });
            }

            handleCheckboxes('considera-novas-qualificacoes');
            handleCheckboxes('primeira-progressao');

            handleInputs('.underline-input');
        });
    </script>
{% endblock %}
